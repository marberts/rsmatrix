<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Making repeat-sales indexes • rsmatrix</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Making repeat-sales indexes">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rsmatrix</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/rsmatrix.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/marberts/rsmatrix/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Making repeat-sales indexes</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/marberts/rsmatrix/blob/main/vignettes/rsmatrix.Rmd" class="external-link"><code>vignettes/rsmatrix.Rmd</code></a></small>
      <div class="d-none name"><code>rsmatrix.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marberts.github.io/rsmatrix/">rsmatrix</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://Matrix.R-forge.R-project.org" class="external-link">Matrix</a></span><span class="op">)</span></span></code></pre></div>
<p>The repeat-sales method is an approach to construct property price
indexes by exploiting multiple sales for the same property over time to
control for time-invariant differences in quality between properties. In
practice, repeat-sales indexes come in a number of different flavors.
There are two broad classes of repeat-sales price indexes—the geometric
repeat-sales index (GRS index) and the arithmetic repeat-sales index
(ARS index)—along with various weighting schemes that can be used to
weight the prices in the index calculation. In all cases these indexes
can be calculated as a linear estimator using a few different matrices.
The purpose of the <strong>rsmatrix</strong> package is to make it easy
to construct these matrices and compute a repeat-sales index.</p>
<div class="section level2">
<h2 id="some-data">Some data<a class="anchor" aria-label="anchor" href="#some-data"></a>
</h2>
<p>Let’s start with some fictitious data on house sales for five cities
over a ten-year period. These data won’t make an interesting price
index, but they’re broadly representative of the type of data used to
make a housing price index in practice.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">15243</span><span class="op">)</span></span>
<span></span>
<span><span class="va">periods</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2010-01-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2019-12-31"</span><span class="op">)</span>, <span class="st">"day"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  sale <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">periods</span>, <span class="fl">5e5</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  property <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%05d"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5e4</span>, <span class="fl">5e5</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  city <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1e5</span>, <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  price <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="fl">5e5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">5e5</span>, <span class="op">-</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">prices</span> <span class="op">&lt;-</span> <span class="va">prices</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">prices</span><span class="op">$</span><span class="va">city</span>, <span class="va">prices</span><span class="op">$</span><span class="va">property</span>, <span class="va">prices</span><span class="op">$</span><span class="va">sale</span><span class="op">)</span>, <span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">prices</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">prices</span><span class="op">)</span></span>
<span><span class="co">#&gt;         sale property city   price</span></span>
<span><span class="co">#&gt; 1 2012-11-18    00001    1 2831000</span></span>
<span><span class="co">#&gt; 2 2018-10-05    00001    1  290000</span></span>
<span><span class="co">#&gt; 3 2010-09-20    00002    1 1519000</span></span>
<span><span class="co">#&gt; 4 2019-12-19    00002    1  269000</span></span>
<span><span class="co">#&gt; 5 2012-06-25    00003    1  712000</span></span>
<span><span class="co">#&gt; 6 2016-10-15    00003    1  520000</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="preparing-to-make-the-matrices">Preparing to make the matrices<a class="anchor" aria-label="anchor" href="#preparing-to-make-the-matrices"></a>
</h2>
<p>The repeat-sales method uses multiple sales for the same property
over time to identify the change in housing prices. The major step to
prepare the data for this method is to make pairs of consecutive sales
(sales pairs). Note that this will remove the sizable chunk of
properties for which there is only one sale.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">prices</span><span class="op">$</span><span class="va">city</span>, <span class="va">prices</span><span class="op">$</span><span class="va">property</span>, drop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/tabulate.html" class="external-link">tabulate</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   0%  25%  50%  75% 100% </span></span>
<span><span class="co">#&gt;    1    1    2    3   11</span></span></code></pre></div>
<p>We’ll be making a monthly index, and it’s useful to turn sale dates
into year months before constructing sales pairs. (Using, say, the
<code>yearmon</code> class from <strong>zoo</strong> instead of a factor
means this can be done after making sales pairs.)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prices</span><span class="op">$</span><span class="va">period</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">prices</span><span class="op">$</span><span class="va">sale</span>, <span class="st">"month"</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="../reference/rs_pairs.html">rs_pairs()</a></code> function gives the position of the
previous sale for each property in each city in the data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sales_pairs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rs_pairs.html">rs_pairs</a></span><span class="op">(</span><span class="va">prices</span><span class="op">$</span><span class="va">sale</span>, <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">prices</span><span class="op">$</span><span class="va">city</span>, <span class="va">prices</span><span class="op">$</span><span class="va">property</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">prices</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"price_prev"</span>, <span class="st">"period_prev"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">prices</span><span class="op">[</span><span class="va">sales_pairs</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"price"</span>, <span class="st">"period"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">prices</span><span class="op">)</span></span>
<span><span class="co">#&gt;         sale property city   price     period price_prev period_prev</span></span>
<span><span class="co">#&gt; 1 2012-11-18    00001    1 2831000 2012-11-01    2831000  2012-11-01</span></span>
<span><span class="co">#&gt; 2 2018-10-05    00001    1  290000 2018-10-01    2831000  2012-11-01</span></span>
<span><span class="co">#&gt; 3 2010-09-20    00002    1 1519000 2010-09-01    1519000  2010-09-01</span></span>
<span><span class="co">#&gt; 4 2019-12-19    00002    1  269000 2019-12-01    1519000  2010-09-01</span></span>
<span><span class="co">#&gt; 5 2012-06-25    00003    1  712000 2012-06-01     712000  2012-06-01</span></span>
<span><span class="co">#&gt; 6 2016-10-15    00003    1  520000 2016-10-01     712000  2012-06-01</span></span></code></pre></div>
<p>Now that the data are oriented as sales pairs, we can remove pairs of
transactions that don’t belong in the calculation. The goal is to help
motivate the assumption that it is only time-invariant differences in
quality that confound a change in housing prices with a change in the
composition of housing that sells over time.</p>
<p>It’s normal to remove pairs of transactions that are close together
(e.g., less than two months apart), as these properties may be flips or
the result of financial difficulty that is not indicative of what the
property would have otherwise sold for. Note that this filters out
properties that only sell once.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prices</span><span class="op">$</span><span class="va">holding_period</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">prices</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">period</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">period_prev</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">prices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">prices</span>, <span class="va">holding_period</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p>Properties with a very large change in price may have undergone major
improvements or depreciation that similarly undermine the assumptions of
the repeat-sales method. There are many ways to try and filter out these
transactions, but a simple approach is to remove pairs of sales where
the monthly return for a property is greater than, say, 2.5 median
absolute deviations from the median. (The <strong>gpindex</strong>
package has several other methods for dealing with extreme changes in
prices.)</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marberts.github.io/gpindex/" class="external-link">gpindex</a></span><span class="op">)</span></span>
<span><span class="va">monthly_return</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">prices</span>, <span class="op">(</span><span class="va">price</span> <span class="op">/</span> <span class="va">price_prev</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">holding_period</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">robust_z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://marberts.github.io/gpindex/reference/grouped.html" class="external-link">grouped</a></span><span class="op">(</span><span class="va">robust_z</span><span class="op">)</span></span>
<span><span class="va">prices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">prices</span>, <span class="op">!</span><span class="fu"><a href="https://marberts.github.io/gpindex/reference/outliers.html" class="external-link">robust_z</a></span><span class="op">(</span><span class="va">monthly_return</span>, group <span class="op">=</span> <span class="va">city</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">prices</span><span class="op">)</span></span>
<span><span class="co">#&gt;          sale property city  price     period price_prev period_prev</span></span>
<span><span class="co">#&gt; 2  2018-10-05    00001    1 290000 2018-10-01    2831000  2012-11-01</span></span>
<span><span class="co">#&gt; 4  2019-12-19    00002    1 269000 2019-12-01    1519000  2010-09-01</span></span>
<span><span class="co">#&gt; 6  2016-10-15    00003    1 520000 2016-10-01     712000  2012-06-01</span></span>
<span><span class="co">#&gt; 8  2011-07-18    00004    1 305000 2011-07-01      90000  2010-07-01</span></span>
<span><span class="co">#&gt; 9  2013-12-03    00004    1 768000 2013-12-01     305000  2011-07-01</span></span>
<span><span class="co">#&gt; 10 2018-08-02    00004    1 121000 2018-08-01     768000  2013-12-01</span></span>
<span><span class="co">#&gt;    holding_period</span></span>
<span><span class="co">#&gt; 2              71</span></span>
<span><span class="co">#&gt; 4             111</span></span>
<span><span class="co">#&gt; 6              52</span></span>
<span><span class="co">#&gt; 8              12</span></span>
<span><span class="co">#&gt; 9              29</span></span>
<span><span class="co">#&gt; 10             56</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="calculating-a-repeat-sales-index">Calculating a repeat-sales index<a class="anchor" aria-label="anchor" href="#calculating-a-repeat-sales-index"></a>
</h2>
<p>With the data in the right form, and potentially problematic
transactions gone, we can now make the repeat-sales matrices and
calculate a housing price index. The strategy is to make a constructor
function based on the sales-pair data that can be used to make the
repeat-sales matrices. These matrices are naturally sparse, and the
large volume of transactions means we’ll benefit for using sparse
matrices.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">matrices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span></span>
<span>  <span class="va">prices</span>,</span>
<span>  <span class="fu"><a href="../reference/rs_matrix.html">rs_matrix</a></span><span class="op">(</span><span class="va">period</span>, <span class="va">period_prev</span>, <span class="va">price</span>, <span class="va">price_prev</span>, <span class="va">city</span>, sparse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The simplest repeat-sales index in the geometric repeat sales (GRS)
index.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The GRS index is simply the first-difference estimator
for the linear model of log price with property fixed effects. This is
easy enough to compute with a panel-data package like
&lt;strong&gt;plm&lt;/strong&gt;, but the repeat-sales matrices are more convenient
when working with sales pairs.&lt;/p&gt;"><sup>1</sup></a>
This index uses the <span class="math inline">\(Z\)</span> and <span class="math inline">\(y\)</span> matrices.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Z</span> <span class="op">&lt;-</span> <span class="fu">matrices</span><span class="op">(</span><span class="st">"Z"</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">matrices</span><span class="op">(</span><span class="st">"y"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/matmult-methods.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">Z</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/matmult-methods.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">Z</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">grs</span><span class="op">)</span></span>
<span><span class="co">#&gt; 6 x 1 Matrix of class "dgeMatrix"</span></span>
<span><span class="co">#&gt;                   [,1]</span></span>
<span><span class="co">#&gt; 1.2010-02-01 0.9319471</span></span>
<span><span class="co">#&gt; 2.2010-02-01 1.0682105</span></span>
<span><span class="co">#&gt; 3.2010-02-01 1.0434833</span></span>
<span><span class="co">#&gt; 4.2010-02-01 1.0185787</span></span>
<span><span class="co">#&gt; 5.2010-02-01 0.9715417</span></span>
<span><span class="co">#&gt; 1.2010-03-01 1.0499673</span></span></code></pre></div>
<p>There are various inverse-variance (or interval) weighting schemes
found in the literature. These weights are the result of regressing the
residuals from the GRS model against a function of the holding period.
The most well-known of these weights, the Case-Shiller weights, model
variance as a linear function of holding period.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grs_resid</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">-</span> <span class="va">Z</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">grs</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mdl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">grs_resid</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">~</span> <span class="va">prices</span><span class="op">$</span><span class="va">holding_period</span><span class="op">)</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/Diagonal.html" class="external-link">Diagonal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted.values</a></span><span class="op">(</span><span class="va">mdl</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">grs_cs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/matmult-methods.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">Z</span>, <span class="va">W</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Z</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/matmult-methods.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">Z</span>, <span class="va">W</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">y</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">grs_cs</span><span class="op">)</span></span>
<span><span class="co">#&gt; 6 x 1 Matrix of class "dgeMatrix"</span></span>
<span><span class="co">#&gt;                   [,1]</span></span>
<span><span class="co">#&gt; 1.2010-02-01 0.9216778</span></span>
<span><span class="co">#&gt; 2.2010-02-01 1.0395309</span></span>
<span><span class="co">#&gt; 3.2010-02-01 1.0265610</span></span>
<span><span class="co">#&gt; 4.2010-02-01 0.9885539</span></span>
<span><span class="co">#&gt; 5.2010-02-01 0.9611430</span></span>
<span><span class="co">#&gt; 1.2010-03-01 1.0373087</span></span></code></pre></div>
<p>Adding the square of the holding period to the model for the
variance, with or without an intercept, is a common variation for the
interval weights. These weights can all be extended to account for the
same house selling more than twice.</p>
<p>Another type of repeat-sales index is the arithmetic repeat sales
(ARS) index. This index uses the <span class="math inline">\(Z\)</span>,
<span class="math inline">\(X\)</span>, and <span class="math inline">\(Y\)</span> matrices.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu">matrices</span><span class="op">(</span><span class="st">"X"</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu">matrices</span><span class="op">(</span><span class="st">"Y"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ars</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/matmult-methods.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">Z</span>, <span class="va">X</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/matmult-methods.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">Z</span>, <span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ars</span><span class="op">)</span></span>
<span><span class="co">#&gt; 6 x 1 Matrix of class "dgeMatrix"</span></span>
<span><span class="co">#&gt;                   [,1]</span></span>
<span><span class="co">#&gt; 1.2010-02-01 0.9049071</span></span>
<span><span class="co">#&gt; 2.2010-02-01 1.1567195</span></span>
<span><span class="co">#&gt; 3.2010-02-01 1.0093530</span></span>
<span><span class="co">#&gt; 4.2010-02-01 1.0107540</span></span>
<span><span class="co">#&gt; 5.2010-02-01 0.9458214</span></span>
<span><span class="co">#&gt; 1.2010-03-01 0.9840927</span></span></code></pre></div>
<p>Like the GRS index, the ARS index can be calculated with
inverse-variance weights.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ars_resid</span> <span class="op">&lt;-</span> <span class="va">Y</span> <span class="op">-</span> <span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="fl">1</span> <span class="op">/</span> <span class="va">ars</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mdl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">ars_resid</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span> <span class="op">~</span> <span class="va">prices</span><span class="op">$</span><span class="va">holding_period</span><span class="op">)</span></span>
<span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/Diagonal.html" class="external-link">Diagonal</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted.values</a></span><span class="op">(</span><span class="va">mdl</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ars_cs</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/matmult-methods.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">Z</span>, <span class="va">W</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">X</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/matmult-methods.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">Z</span>, <span class="va">W</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ars_cs</span><span class="op">)</span></span>
<span><span class="co">#&gt; 6 x 1 Matrix of class "dgeMatrix"</span></span>
<span><span class="co">#&gt;                   [,1]</span></span>
<span><span class="co">#&gt; 1.2010-02-01 0.9040179</span></span>
<span><span class="co">#&gt; 2.2010-02-01 1.1194659</span></span>
<span><span class="co">#&gt; 3.2010-02-01 0.9667189</span></span>
<span><span class="co">#&gt; 4.2010-02-01 0.9549480</span></span>
<span><span class="co">#&gt; 5.2010-02-01 0.9161033</span></span>
<span><span class="co">#&gt; 1.2010-03-01 0.9856805</span></span></code></pre></div>
<p>Dividing the <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> matrices by the price of the first sale
for each row produces an equally-weighted arithmetic index (as opposed
to value-weighted index).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ars_ew</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span></span>
<span>  <span class="va">prices</span>,</span>
<span>  <span class="fl">1</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/matmult-methods.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">Z</span>, <span class="va">X</span> <span class="op">/</span> <span class="va">price_prev</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/matmult-methods.html" class="external-link">crossprod</a></span><span class="op">(</span><span class="va">Z</span>, <span class="va">Y</span> <span class="op">/</span> <span class="va">price_prev</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ars_ew</span><span class="op">)</span></span>
<span><span class="co">#&gt; 6 x 1 Matrix of class "dgeMatrix"</span></span>
<span><span class="co">#&gt;                   [,1]</span></span>
<span><span class="co">#&gt; 1.2010-02-01 0.9831875</span></span>
<span><span class="co">#&gt; 2.2010-02-01 1.1454796</span></span>
<span><span class="co">#&gt; 3.2010-02-01 1.1332362</span></span>
<span><span class="co">#&gt; 4.2010-02-01 0.9957358</span></span>
<span><span class="co">#&gt; 5.2010-02-01 0.8859613</span></span>
<span><span class="co">#&gt; 1.2010-03-01 0.9510087</span></span></code></pre></div>
<p>Once the index is calculated, it’s often easier to turn into a
matrix-like object with cities as rows and time periods as columns. The
easiest way to do this is with the <strong>piar</strong> package.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marberts.github.io/piar/" class="external-link">piar</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">dimensions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/strsplit.html" class="external-link">strsplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">grs</span><span class="op">)</span>, <span class="st">"."</span>, fixed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">grs_piar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://marberts.github.io/piar/reference/elemental_index.html" class="external-link">elemental_index</a></span><span class="op">(</span></span>
<span>  <span class="va">grs</span>,</span>
<span>  period <span class="op">=</span> <span class="va">dimensions</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>,</span>
<span>  ea <span class="op">=</span> <span class="va">dimensions</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span>
<span>  chainable <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">grs_piar</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Fixed-base price index for 5 levels over 5 time periods </span></span>
<span><span class="co">#&gt;   2010-02-01 2010-03-01 2010-04-01 2010-05-01 2010-06-01</span></span>
<span><span class="co">#&gt; 1  0.9319471   1.049967  1.0312130  0.9332345  1.0074811</span></span>
<span><span class="co">#&gt; 2  1.0682105   0.984812  1.0840525  1.0113186  0.9645851</span></span>
<span><span class="co">#&gt; 3  1.0434833   1.044671  0.9526141  0.9330665  1.0234300</span></span>
<span><span class="co">#&gt; 4  1.0185787   1.048738  1.0757727  1.1258297  1.0099260</span></span>
<span><span class="co">#&gt; 5  0.9715417   1.025133  1.0648382  1.0387825  1.0930171</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sales-pair-contributions">Sales pair contributions<a class="anchor" aria-label="anchor" href="#sales-pair-contributions"></a>
</h2>
<p>Repeat-sales indexes have a simple interpretation as a type of
efficient back-price imputation. It’s best to include the base period of
the index prior to doing such an imputation.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="st">"2010-01-01"</span>, sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span><span class="op">)</span>, <span class="va">grs</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">ars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="st">"2010-01-01"</span>, sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span><span class="op">)</span>, <span class="va">ars</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>The GRS index at a point in time is simply the geometric mean of
imputed price relatives. This makes it easy to calculate the
percent-change contribution of each property at each point in time.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">grs_contributions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Map</a></span><span class="op">(</span></span>
<span>  \<span class="op">(</span><span class="va">df</span>, <span class="va">df_prev</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">impute_back</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">price_prev</span> <span class="op">/</span> <span class="va">grs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">city</span>, <span class="va">period_prev</span>, sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">impute_back</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>    <span class="va">impute_forward</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">df_prev</span>, <span class="va">price</span> <span class="op">/</span> <span class="va">grs</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">city</span>, <span class="va">period</span>, sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">impute_forward</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">df_prev</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://marberts.github.io/gpindex/reference/contributions.html" class="external-link">geometric_contributions</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">price</span> <span class="op">/</span> <span class="va">impute_back</span>, <span class="va">df_prev</span><span class="op">$</span><span class="va">price_prev</span> <span class="op">/</span> <span class="va">impute_forward</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">prices</span>, <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">prices</span><span class="op">$</span><span class="va">city</span>, <span class="va">prices</span><span class="op">$</span><span class="va">period</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">prices</span>, <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">prices</span><span class="op">$</span><span class="va">city</span>, <span class="va">prices</span><span class="op">$</span><span class="va">period_prev</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">grs_contributions</span>, <span class="va">sum</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">grs</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">grs_contributions</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.008215347  0.009111019</span></span></code></pre></div>
<p>The same applies to the ARS index, noting that it is a weighted
arithmetic mean of imputed price relatives.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ars_contributions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Map</a></span><span class="op">(</span></span>
<span>  \<span class="op">(</span><span class="va">df</span>, <span class="va">df_prev</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">impute_back</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">price_prev</span> <span class="op">/</span> <span class="va">ars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">city</span>, <span class="va">period_prev</span>, sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">impute_back</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span>    <span class="va">impute_forward</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">df_prev</span>, <span class="va">price</span> <span class="op">/</span> <span class="va">ars</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">city</span>, <span class="va">period</span>, sep <span class="op">=</span> <span class="st">"."</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">impute_forward</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">df_prev</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://marberts.github.io/gpindex/reference/contributions.html" class="external-link">arithmetic_contributions</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">price</span> <span class="op">/</span> <span class="va">impute_back</span>, <span class="va">df_prev</span><span class="op">$</span><span class="va">price_prev</span> <span class="op">/</span> <span class="va">impute_forward</span><span class="op">)</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">impute_back</span>, <span class="va">impute_forward</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">prices</span>, <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">prices</span><span class="op">$</span><span class="va">city</span>, <span class="va">prices</span><span class="op">$</span><span class="va">period</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/split.html" class="external-link">split</a></span><span class="op">(</span><span class="va">prices</span>, <span class="fu"><a href="https://rdrr.io/r/base/interaction.html" class="external-link">interaction</a></span><span class="op">(</span><span class="va">prices</span><span class="op">$</span><span class="va">city</span>, <span class="va">prices</span><span class="op">$</span><span class="va">period_prev</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/all.equal-methods.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">ars_contributions</span>, <span class="va">sum</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span>, <span class="va">ars</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="va">ars_contributions</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -0.07041332  0.08316015</span></span></code></pre></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Steve Martin.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
